<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Service Contact Aggregator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-red: #e63946;
            --light-red: #ff6b6b;
            --dark-red: #c1121f;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --black: #212529;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-gray);
            color: var(--black);
        }
        
        /* Navbar */
        .navbar {
            background-color: var(--primary-red) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--white) !important;
            font-size: 1.5rem;
        }
        
        .navbar-nav .nav-link {
            color: var(--white) !important;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .navbar-nav .nav-link:hover {
            background-color: var(--dark-red);
        }
        
        /* Hero Section */
        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1582719508461-905c673771fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: var(--white);
            padding: 100px 0;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .hero-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
        }
        
        /* Cards */
        .service-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 25px;
            height: 100%;
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background-color: var(--primary-red);
            color: var(--white);
            font-weight: 600;
            padding: 15px;
            text-align: center;
        }
        
        .card-body {
            padding: 25px;
            background-color: var(--white);
        }
        
        .emergency-btn {
            background-color: var(--primary-red);
            border: none;
            color: var(--white);
            font-weight: 600;
            padding: 12px 20px;
            border-radius: 8px;
            width: 100%;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .emergency-btn:hover {
            background-color: var(--dark-red);
            color: var(--white);
        }
        
        /* Footer */
        .footer {
            background-color: var(--dark-gray);
            color: var(--white);
            padding: 40px 0 20px;
            margin-top: 60px;
        }
        
        .footer h5 {
            color: var(--primary-red);
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .footer p {
            color: var(--medium-gray);
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: var(--medium-gray);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--primary-red);
        }
        
        .copyright {
            border-top: 1px solid var(--dark-gray);
            padding-top: 20px;
            margin-top: 30px;
            text-align: center;
            color: var(--medium-gray);
            font-size: 0.9rem;
        }
        
        /* Search Section */
        .search-section {
            background-color: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 40px;
        }
        
        /* Emergency Categories */
        .category-btn {
            background-color: var(--white);
            border: 2px solid var(--primary-red);
            color: var(--primary-red);
            font-weight: 600;
            padding: 12px 20px;
            border-radius: 8px;
            transition: all 0.3s;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .category-btn:hover {
            background-color: var(--primary-red);
            color: var(--white);
            transform: translateY(-3px);
        }
        
        .category-btn i {
            margin-right: 8px;
        }
        
        /* Modal */
        .modal-header {
            background-color: var(--primary-red);
            color: var(--white);
        }
        
        /* Map Container */
        #map {
            height: 400px;
            width: 100%;
            border-radius: 10px;
            margin-top: 20px;
            z-index: 1;
        }
        
        .map-container {
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .map-title {
            background-color: var(--primary-red);
            color: white;
            padding: 10px 15px;
            border-radius: 10px 10px 0 0;
            font-weight: 600;
        }
        
        /* City Filter */
        .city-filter {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .city-chip {
            background-color: var(--white);
            border: 1px solid var(--primary-red);
            color: var(--primary-red);
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .city-chip:hover, .city-chip.active {
            background-color: var(--primary-red);
            color: var(--white);
        }
        
        /* Utility Classes */
        .text-red {
            color: var(--primary-red);
        }
        
        .bg-red {
            background-color: var(--primary-red);
        }
        
        .bg-light-gray {
            background-color: var(--light-gray);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            #map {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-first-aid me-2"></i>Emergency Contact Aggregator
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#home"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#services"><i class="fas fa-phone-alt me-1"></i> Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#search"><i class="fas fa-search me-1"></i> Search</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about"><i class="fas fa-info-circle me-1"></i> About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#adminModal">
                            <i class="fas fa-user-shield me-1"></i> Admin
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section" id="home">
        <div class="container">
            <h1 class="hero-title">Emergency Service Contact Aggregator</h1>
            <p class="hero-subtitle">A centralized web application that allows citizens to easily locate and contact emergency services nearby or through a single dashboard.</p>
            <div class="mt-4">
                <a href="#services" class="btn btn-lg emergency-btn me-3">
                    <i class="fas fa-phone-alt me-2"></i> Find Emergency Services
                </a>
                <a href="#search" class="btn btn-lg btn-outline-light">
                    <i class="fas fa-search me-2"></i> Search by Location
                </a>
            </div>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section" id="search">
        <div class="container">
            <h2 class="text-center mb-4 text-red">Search Emergency Services</h2>
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control form-control-lg" placeholder="Enter city or keyword..." id="searchInput">
                        <button class="btn bg-red text-white" type="button" id="searchButton">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    
                    <div class="text-center mb-4">
                        <p class="text-muted">Or browse by category:</p>
                        <div class="d-flex flex-wrap justify-content-center">
                            <button class="category-btn" data-category="police">
                                <i class="fas fa-shield-alt"></i> Police
                            </button>
                            <button class="category-btn" data-category="ambulance">
                                <i class="fas fa-ambulance"></i> Ambulance
                            </button>
                            <button class="category-btn" data-category="fire">
                                <i class="fas fa-fire-extinguisher"></i> Fire
                            </button>
                            <button class="category-btn" data-category="women">
                                <i class="fas fa-female"></i> Women Helpline
                            </button>
                            <button class="category-btn" data-category="hospital">
                                <i class="fas fa-hospital"></i> Hospital
                            </button>
                            <button class="category-btn" data-category="disaster">
                                <i class="fas fa-house-damage"></i> Disaster Control
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <p class="text-muted">Quick filter by Maharashtra cities:</p>
                        <div class="city-filter" id="cityFilter">
                            <!-- Cities will be added dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map Container -->
            <div class="map-container mt-5">
                <div class="map-title">
                    <i class="fas fa-map-marked-alt me-2"></i> Emergency Services Map
                </div>
                <div id="map"></div>
                <div class="bg-light-gray p-3">
                    <p class="mb-0 text-center"><i class="fas fa-info-circle text-red me-2"></i>Click on any marker to see emergency service details and get directions</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-5 bg-light-gray">
        <div class="container">
            <h2 class="text-center mb-5 text-red">Emergency Services</h2>
            <div class="row" id="servicesContainer">
                <!-- Services will be loaded dynamically via JavaScript -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5 text-red">About This Project</h2>
            <div class="row">
                <div class="col-md-6">
                    <div class="card service-card">
                        <div class="card-header">
                            <i class="fas fa-info-circle me-2"></i> Project Overview
                        </div>
                        <div class="card-body">
                            <p>This project is ideal for <strong>community service, smart city, and digital awareness initiatives</strong>. It helps users quickly find and contact essential emergency services through a web or mobile app.</p>
                            <p><strong>BCA 3rd Year Project</strong> mentored by <strong>Komal and Sucheta Yambal Madam</strong>.</p>
                            <h5 class="text-red mt-4">Core Features:</h5>
                            <ul>
                                <li>View categorized emergency contacts</li>
                                <li>Search contacts by location or keyword</li>
                                <li>Quick "Call Now" and "SMS Alert" buttons</li>
                                <li>Add new verified contacts (admin role)</li>
                                <li>Map integration for nearest stations</li>
                                <li>Offline access (optional)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card service-card">
                        <div class="card-header">
                            <i class="fas fa-tasks me-2"></i> Project Phases
                        </div>
                        <div class="card-body">
                            <ol>
                                <li><strong>Phase 1:</strong> Requirement Analysis & Planning</li>
                                <li><strong>Phase 2:</strong> UI Designing</li>
                                <li><strong>Phase 3:</strong> Development</li>
                                <li><strong>Phase 4:</strong> Deployment</li>
                                <li><strong>Phase 5:</strong> Documentation & Presentation</li>
                            </ol>
                            
                            <h5 class="text-red mt-4">Tech Stack:</h5>
                            <div class="d-flex flex-wrap">
                                <span class="badge bg-red me-2 mb-2 p-2">HTML/CSS/JS</span>
                                <span class="badge bg-red me-2 mb-2 p-2">Bootstrap</span>
                                <span class="badge bg-red me-2 mb-2 p-2">Python Flask</span>
                                <span class="badge bg-red me-2 mb-2 p-2">SQLite/MySQL</span>
                                <span class="badge bg-red me-2 mb-2 p-2">Leaflet Maps</span>
                                <span class="badge bg-red me-2 mb-2 p-2">Figma</span>
                            </div>
                            
                            <h5 class="text-red mt-4">Stakeholders:</h5>
                            <p><strong>Admin:</strong> Add/edit/delete contact information<br>
                            <strong>User:</strong> View, search, and directly contact emergency services</p>
                            
                            <h5 class="text-red mt-4">Maharashtra Coverage:</h5>
                            <p>This application covers emergency services for 20 major cities across Maharashtra including Mumbai, Pune, Nagpur, Nashik, Aurangabad, and more.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Emergency Contact Aggregator</h5>
                    <p>A centralized web application for emergency service contacts. Part of BCA 3rd Year project.</p>
                    <p><i class="fas fa-user-graduate me-2"></i> Mentored by: Komal and Sucheta Yambal Madam</p>
                </div>
                <div class="col-md-4">
                    <h5>Quick Links</h5>
                    <ul class="footer-links">
                        <li><a href="#home">Home</a></li>
                        <li><a href="#services">Emergency Services</a></li>
                        <li><a href="#search">Search Services</a></li>
                        <li><a href="#about">About Project</a></li>
                        <li><a href="#" data-bs-toggle="modal" data-bs-target="#feedbackModal">Submit Feedback</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Important Contacts</h5>
                    <ul class="footer-links">
                        <li><i class="fas fa-phone-alt me-2"></i> National Emergency: 112</li>
                        <li><i class="fas fa-shield-alt me-2"></i> Police: 100</li>
                        <li><i class="fas fa-ambulance me-2"></i> Ambulance: 102</li>
                        <li><i class="fas fa-fire-extinguisher me-2"></i> Fire: 101</li>
                        <li><i class="fas fa-female me-2"></i> Women Helpline: 1091</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Emergency Service Contact Aggregator. BCA 3rd Year Project. All rights reserved.</p>
                <p>This is a demonstration project for educational purposes.</p>
            </div>
        </div>
    </footer>

    <!-- Admin Login Modal -->
    <div class="modal fade" id="adminModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-shield me-2"></i> Admin Login</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="adminForm">
                        <div class="mb-3">
                            <label for="adminUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="adminUsername" placeholder="Enter admin username" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="adminPassword" placeholder="Enter password" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn emergency-btn">Login as Admin</button>
                        </div>
                    </form>
                    <div class="mt-3 text-center">
                        <p class="text-muted">Admin can add/edit/delete emergency contacts.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal fade" id="feedbackModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-comment-dots me-2"></i> Submit Feedback</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="feedbackForm">
                        <div class="mb-3">
                            <label for="feedbackName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="feedbackName" placeholder="Your name" required>
                        </div>
                        <div class="mb-3">
                            <label for="feedbackContact" class="form-label">Contact (Email/Phone)</label>
                            <input type="text" class="form-control" id="feedbackContact" placeholder="Email or phone number" required>
                        </div>
                        <div class="mb-3">
                            <label for="feedbackMessage" class="form-label">Message / Suggestion</label>
                            <textarea class="form-control" id="feedbackMessage" rows="4" placeholder="Your feedback or suggestions for improvement" required></textarea>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn emergency-btn">Submit Feedback</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Details Modal with Map -->
    <div class="modal fade" id="contactModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalTitle">Contact Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="contactModalBody">
                    <!-- Contact details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="#" class="btn emergency-btn" id="callNowBtn"><i class="fas fa-phone me-2"></i> Call Now</a>
                    <button type="button" class="btn btn-outline-danger" id="smsBtn"><i class="fas fa-sms me-2"></i> SMS Alert</button>
                    <button type="button" class="btn btn-outline-primary" id="getDirectionsBtn"><i class="fas fa-directions me-2"></i> Get Directions</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // Global variables
        let map;
        let markers = [];
        let currentCity = null;
        let allServices = [];

        // Maharashtra cities data with coordinates (fallback data)
        const maharashtraCities = [
            { name: "Mumbai", lat: 19.0760, lng: 72.8777 },
            { name: "Pune", lat: 18.5204, lng: 73.8567 },
            { name: "Nagpur", lat: 21.1458, lng: 79.0882 },
            { name: "Nashik", lat: 19.9975, lng: 73.7898 },
            { name: "Aurangabad", lat: 19.8762, lng: 75.3433 },
            { name: "Solapur", lat: 17.6599, lng: 75.9064 },
            { name: "Amravati", lat: 20.9374, lng: 77.7796 },
            { name: "Kolhapur", lat: 16.7050, lng: 74.2433 },
            { name: "Sangli", lat: 16.8524, lng: 74.5815 },
            { name: "Jalgaon", lat: 21.0077, lng: 75.5626 },
            { name: "Akola", lat: 20.7030, lng: 77.0235 },
            { name: "Latur", lat: 18.4088, lng: 76.5604 },
            { name: "Dhule", lat: 20.9020, lng: 74.7776 },
            { name: "Ahmednagar", lat: 19.0946, lng: 74.7384 },
            { name: "Chandrapur", lat: 19.9703, lng: 79.3024 },
            { name: "Parbhani", lat: 19.2686, lng: 76.7708 },
            { name: "Jalna", lat: 19.8410, lng: 75.8860 },
            { name: "Bhiwandi", lat: 19.3002, lng: 73.0588 },
            { name: "Panvel", lat: 18.9881, lng: 73.1105 },
            { name: "Thane", lat: 19.2183, lng: 72.9781 }
        ];

        // Test backend connection
        async function testBackendConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/test-connection`);
                const data = await response.json();
                
                if (data.success) {
                    console.log('âœ… Backend connected successfully!');
                    console.log(`ðŸ“Š Total services in database: ${data.services_count}`);
                    return true;
                } else {
                    console.error('âŒ Backend connection failed:', data.message);
                    return false;
                }
            } catch (error) {
                console.error('âŒ Cannot connect to backend:', error);
                return false;
            }
        }

        // Load all services from backend
        async function loadAllServices() {
            try {
                const response = await fetch(`${API_BASE_URL}/services`);
                const data = await response.json();
                
                if (data.success) {
                    allServices = data.services;
                    console.log(`âœ… Loaded ${data.count} services from backend`);
                    return data.services;
                } else {
                    console.error('Error loading services:', data.error);
                    // Generate demo data if backend fails
                    return generateDemoServices();
                }
            } catch (error) {
                console.error('Error fetching services:', error);
                // Generate demo data if backend fails
                return generateDemoServices();
            }
        }

        // Generate demo services for fallback
        function generateDemoServices() {
            let services = [];
            let id = 1;
            
            maharashtraCities.forEach(city => {
                const cityName = city.name;
                
                // Police services
                services.push({
                    id: id++,
                    category: "police",
                    name: `${cityName} Police Commissionerate`,
                    phone: "100",
                    address: `Police Headquarters, ${cityName}`,
                    city: cityName,
                    state: "Maharashtra",
                    latitude: city.lat + (Math.random() * 0.05 - 0.025),
                    longitude: city.lng + (Math.random() * 0.05 - 0.025),
                    verified: false,
                    source: "Demo Data"
                });
                
                // Fire services
                services.push({
                    id: id++,
                    category: "fire",
                    name: `${cityName} Fire Brigade`,
                    phone: "101",
                    address: `Fire Station, Main Road, ${cityName}`,
                    city: cityName,
                    state: "Maharashtra",
                    latitude: city.lat + (Math.random() * 0.05 - 0.025),
                    longitude: city.lng + (Math.random() * 0.05 - 0.025),
                    verified: false,
                    source: "Demo Data"
                });
            });
            
            return services;
        }

        // Load cities from backend
        async function loadCities() {
            try {
                const response = await fetch(`${API_BASE_URL}/cities`);
                const data = await response.json();
                
                if (data.success) {
                    return data.cities;
                } else {
                    console.error('Error loading cities:', data.error);
                    return maharashtraCities; // Fallback to static data
                }
            } catch (error) {
                console.error('Error fetching cities:', error);
                return maharashtraCities; // Fallback to static data
            }
        }

        // Initialize the map
        function initMap() {
            // Center map on Maharashtra
            map = L.map('map').setView([19.7515, 75.7139], 7);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        }

        // Update map markers based on filtered services
        function updateMapMarkers(services) {
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            // Add new markers
            services.forEach(service => {
                const categoryIcons = {
                    police: 'fa-shield-alt',
                    ambulance: 'fa-ambulance',
                    fire: 'fa-fire-extinguisher',
                    women: 'fa-female',
                    hospital: 'fa-hospital',
                    disaster: 'fa-house-damage',
                    child: 'fa-child',
                    senior: 'fa-user-tie',
                    mental_health: 'fa-brain'
                };
                
                const categoryColors = {
                    police: 'blue',
                    ambulance: 'green',
                    fire: 'red',
                    women: 'purple',
                    hospital: 'orange',
                    disaster: 'brown',
                    child: 'pink',
                    senior: 'gray',
                    mental_health: 'teal'
                };
                
                if (service.latitude && service.longitude) {
                    // Create custom icon
                    const icon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background-color: ${categoryColors[service.category] || 'blue'}; 
                               width: 30px; height: 30px; border-radius: 50%; 
                               display: flex; align-items: center; justify-content: center;
                               color: white; font-size: 14px;">
                               <i class="fas ${categoryIcons[service.category] || 'fa-shield-alt'}"></i>
                               </div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });
                    
                    const marker = L.marker([service.latitude, service.longitude], { icon: icon })
                        .addTo(map)
                        .bindPopup(`
                            <strong>${service.name}</strong><br>
                            <i class="fas fa-phone"></i> ${service.phone}<br>
                            <i class="fas fa-map-marker-alt"></i> ${service.city}, ${service.state}<br>
                            <button onclick="showContactDetailsModal(${service.id})" 
                                    style="background-color: var(--primary-red); color: white; 
                                           border: none; padding: 5px 10px; border-radius: 4px; 
                                           margin-top: 5px; cursor: pointer;">
                                View Details
                            </button>
                        `);
                    
                    markers.push(marker);
                }
            });
            
            // Fit map to show all markers
            if (services.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Show directions to a specific service
        function showDirections(lat, lng, serviceName) {
            const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=driving`;
            window.open(googleMapsUrl, '_blank');
            
            // Show notification
            alert(`Opening Google Maps with directions to ${serviceName}. 
                   \nAllow location access for turn-by-turn navigation.`);
        }

        // Function to display services
        function displayServices(services = []) {
            const container = document.getElementById('servicesContainer');
            container.innerHTML = '';
            
            if (services.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4 class="text-red">No services found</h4>
                        <p>No emergency services found matching your search. Try a different term or category.</p>
                    </div>
                `;
                return;
            }
            
            const categoryIcons = {
                police: 'fa-shield-alt',
                ambulance: 'fa-ambulance',
                fire: 'fa-fire-extinguisher',
                women: 'fa-female',
                hospital: 'fa-hospital',
                disaster: 'fa-house-damage',
                child: 'fa-child',
                senior: 'fa-user-tie',
                mental_health: 'fa-brain'
            };
            
            const categoryNames = {
                police: 'Police',
                ambulance: 'Ambulance',
                fire: 'Fire Department',
                women: 'Women Helpline',
                hospital: 'Hospital',
                disaster: 'Disaster Control',
                child: 'Child Helpline',
                senior: 'Senior Citizen',
                mental_health: 'Mental Health'
            };
            
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'col-md-4 col-lg-3';
                card.innerHTML = `
                    <div class="card service-card">
                        <div class="card-header">
                            <i class="fas ${categoryIcons[service.category] || 'fa-shield-alt'} me-2"></i>${categoryNames[service.category] || 'Emergency Service'}
                            ${service.verified ? '<span class="badge bg-success float-end">Verified</span>' : '<span class="badge bg-warning float-end">Demo</span>'}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${service.name}</h5>
                            <p class="card-text">
                                <i class="fas fa-phone text-red me-2"></i><strong>${service.phone}</strong>
                                ${service.alternate_phone ? `<br><small>Alt: ${service.alternate_phone}</small>` : ''}<br>
                                <i class="fas fa-map-marker-alt text-red me-2"></i>${service.city}, ${service.state}<br>
                                ${service.operational_hours ? `<i class="fas fa-clock text-red me-2"></i>${service.operational_hours}<br>` : ''}
                                <small class="text-muted">${service.source || 'Emergency Service'}</small>
                            </p>
                            <button class="btn emergency-btn view-details" data-id="${service.id}">
                                <i class="fas fa-info-circle me-2"></i>View Details
                            </button>
                            <button class="btn btn-outline-danger call-direct mt-2" data-phone="${service.phone}">
                                <i class="fas fa-phone me-2"></i>Call Now
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            // Add event listeners to view details buttons
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', function() {
                    const serviceId = parseInt(this.getAttribute('data-id'));
                    showContactDetailsModal(serviceId);
                });
            });
            
            // Add event listeners to call buttons
            document.querySelectorAll('.call-direct').forEach(button => {
                button.addEventListener('click', function() {
                    const phoneNumber = this.getAttribute('data-phone');
                    // For mobile devices, use tel: protocol
                    if (/Mobi|Android/i.test(navigator.userAgent)) {
                        window.location.href = `tel:${phoneNumber}`;
                    } else {
                        alert(`Calling ${phoneNumber}...\n\nIn a real scenario, this would initiate a phone call.\n\nYou can manually call: ${phoneNumber}`);
                    }
                });
            });
        }
        
        // Function to show contact details in modal
        async function showContactDetailsModal(serviceId) {
            try {
                // Try to fetch from backend first
                const response = await fetch(`${API_BASE_URL}/services/${serviceId}`);
                const data = await response.json();
                
                let service;
                if (data.success) {
                    service = data.service;
                } else {
                    // Fallback to demo data
                    service = allServices.find(s => s.id === serviceId);
                    if (!service) {
                        alert('Service not found');
                        return;
                    }
                }
                
                const categoryNames = {
                    police: 'Police',
                    ambulance: 'Ambulance',
                    fire: 'Fire Department',
                    women: 'Women Helpline',
                    hospital: 'Hospital',
                    disaster: 'Disaster Control',
                    child: 'Child Helpline',
                    senior: 'Senior Citizen',
                    mental_health: 'Mental Health'
                };
                
                document.getElementById('contactModalTitle').textContent = service.name;
                
                // Create mini map for modal
                const miniMapId = `miniMap-${serviceId}`;
                const mapHtml = service.latitude && service.longitude ? `
                    <div id="${miniMapId}" style="height: 200px; width: 100%; border-radius: 8px; margin-top: 10px;"></div>
                ` : '<p class="text-muted">Location not available</p>';
                
                document.getElementById('contactModalBody').innerHTML = `
                    <div class="contact-details">
                        <p><strong>Category:</strong> ${categoryNames[service.category] || 'Emergency Service'}</p>
                        <p><strong>Phone Number:</strong> ${service.phone}</p>
                        ${service.alternate_phone ? `<p><strong>Alternate Phone:</strong> ${service.alternate_phone}</p>` : ''}
                        ${service.email ? `<p><strong>Email:</strong> ${service.email}</p>` : ''}
                        <p><strong>Address:</strong> ${service.address}</p>
                        <p><strong>City:</strong> ${service.city}</p>
                        <p><strong>State:</strong> ${service.state}</p>
                        ${service.operational_hours ? `<p><strong>Operational Hours:</strong> ${service.operational_hours}</p>` : ''}
                        ${service.website ? `<p><strong>Website:</strong> <a href="${service.website}" target="_blank">${service.website}</a></p>` : ''}
                        <p><strong>Source:</strong> ${service.source || 'Emergency Database'}</p>
                        <p><strong>Status:</strong> ${service.verified ? '<span class="badge bg-success">Verified</span>' : '<span class="badge bg-warning">Demo Data</span>'}</p>
                    </div>
                    <div class="mt-4">
                        <h6 class="text-red"><i class="fas fa-map-marked-alt me-2"></i>Location Map:</h6>
                        ${mapHtml}
                    </div>
                `;
                
                document.getElementById('callNowBtn').href = `tel:${service.phone}`;
                
                // Add event listener for directions button
                document.getElementById('getDirectionsBtn').onclick = () => {
                    if (service.latitude && service.longitude) {
                        showDirections(service.latitude, service.longitude, service.name);
                    } else {
                        alert('Location coordinates not available for this service.');
                    }
                };
                
                // Initialize mini map in modal if coordinates exist
                if (service.latitude && service.longitude) {
                    setTimeout(() => {
                        const miniMap = L.map(miniMapId).setView([service.latitude, service.longitude], 14);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; OpenStreetMap contributors'
                        }).addTo(miniMap);
                        
                        // Add marker for this service
                        L.marker([service.latitude, service.longitude]).addTo(miniMap)
                            .bindPopup(`<strong>${service.name}</strong><br>${service.address}`)
                            .openPopup();
                    }, 100);
                }
                
                const contactModal = new bootstrap.Modal(document.getElementById('contactModal'));
                contactModal.show();
                
            } catch (error) {
                console.error('Error loading service details:', error);
                alert('Error loading service details');
            }
        }
        
        // Function to filter services by category
        async function filterByCategory(category) {
            if (category === 'all') {
                const services = await loadAllServices();
                displayServices(services);
                updateMapMarkers(services);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/category/${category}`);
                const data = await response.json();
                
                if (data.success) {
                    displayServices(data.services);
                    updateMapMarkers(data.services);
                } else {
                    // Fallback: filter from loaded services
                    const filteredServices = allServices.filter(service => service.category === category);
                    displayServices(filteredServices);
                    updateMapMarkers(filteredServices);
                }
            } catch (error) {
                console.error('Error filtering by category:', error);
                // Fallback: filter from loaded services
                const filteredServices = allServices.filter(service => service.category === category);
                displayServices(filteredServices);
                updateMapMarkers(filteredServices);
            }
        }
        
        // Function to filter services by city
        async function filterByCity(cityName) {
            currentCity = cityName;
            
            try {
                const response = await fetch(`${API_BASE_URL}/cities/${cityName}`);
                const data = await response.json();
                
                if (data.success) {
                    displayServices(data.services);
                    updateMapMarkers(data.services);
                } else {
                    // Fallback: filter from loaded services
                    const filteredServices = allServices.filter(service => 
                        service.city.toLowerCase() === cityName.toLowerCase()
                    );
                    displayServices(filteredServices);
                    updateMapMarkers(filteredServices);
                }
                
                // Update city filter chips
                document.querySelectorAll('.city-chip').forEach(chip => {
                    if (chip.textContent === cityName) {
                        chip.classList.add('active');
                    } else {
                        chip.classList.remove('active');
                    }
                });
                
                // Update category buttons
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.backgroundColor = '';
                    btn.style.color = '';
                });
                
            } catch (error) {
                console.error('Error filtering by city:', error);
                // Fallback: filter from loaded services
                const filteredServices = allServices.filter(service => 
                    service.city.toLowerCase() === cityName.toLowerCase()
                );
                displayServices(filteredServices);
                updateMapMarkers(filteredServices);
            }
        }
        
        // Function to search services
        async function searchServices(query) {
            if (!query.trim()) {
                const services = await loadAllServices();
                displayServices(services);
                updateMapMarkers(services);
                
                // Reset city filter chips
                document.querySelectorAll('.city-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                
                // Reset category buttons
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.backgroundColor = '';
                    btn.style.color = '';
                });
                
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.success) {
                    displayServices(data.results);
                    updateMapMarkers(data.results);
                } else {
                    // Fallback: search in loaded services
                    const searchTerm = query.toLowerCase();
                    const filteredServices = allServices.filter(service => 
                        service.name.toLowerCase().includes(searchTerm) || 
                        service.city.toLowerCase().includes(searchTerm) ||
                        service.address.toLowerCase().includes(searchTerm)
                    );
                    displayServices(filteredServices);
                    updateMapMarkers(filteredServices);
                }
                
                // Check if search matches a city
                const matchingCity = maharashtraCities.find(city => 
                    city.name.toLowerCase().includes(query.toLowerCase())
                );
                
                if (matchingCity) {
                    // Update city filter chips
                    document.querySelectorAll('.city-chip').forEach(chip => {
                        if (chip.textContent.toLowerCase().includes(query.toLowerCase())) {
                            chip.classList.add('active');
                            currentCity = chip.textContent;
                        } else {
                            chip.classList.remove('active');
                        }
                    });
                } else {
                    // Reset city filter chips
                    document.querySelectorAll('.city-chip').forEach(chip => {
                        chip.classList.remove('active');
                    });
                }
                
                // Reset category buttons
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.backgroundColor = '';
                    btn.style.color = '';
                });
                
            } catch (error) {
                console.error('Error searching services:', error);
                // Fallback: search in loaded services
                const searchTerm = query.toLowerCase();
                const filteredServices = allServices.filter(service => 
                    service.name.toLowerCase().includes(searchTerm) || 
                    service.city.toLowerCase().includes(searchTerm) ||
                    service.address.toLowerCase().includes(searchTerm)
                );
                displayServices(filteredServices);
                updateMapMarkers(filteredServices);
            }
        }
        
        // Create city filter chips
        async function createCityFilters() {
            const cities = await loadCities();
            const container = document.getElementById('cityFilter');
            container.innerHTML = '';
            
            cities.forEach(city => {
                const chip = document.createElement('div');
                chip.className = 'city-chip';
                chip.textContent = city.name;
                chip.addEventListener('click', () => {
                    filterByCity(city.name);
                });
                container.appendChild(chip);
            });
        }
        
        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                const data = await response.json();
                
                if (data.success) {
                    console.log('ðŸ“Š Statistics:', data.stats);
                }
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ðŸš€ Initializing Emergency Helpline Application...');
            
            // Test backend connection first
            const isConnected = await testBackendConnection();
            
            if (!isConnected) {
                // Show warning but continue with demo data
                const warningHtml = `
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Backend Server Not Running</strong>
                        <p class="mb-0">Please start the backend server to see real emergency contacts.</p>
                        <p><strong>Run in terminal:</strong> <code>python backend/app.py</code></p>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                // Insert at the beginning of the services container
                document.getElementById('servicesContainer').insertAdjacentHTML('afterbegin', warningHtml);
            }
            
            // Create city filters
            await createCityFilters();
            
            // Initialize map
            initMap();
            
            // Load all services initially
            const services = await loadAllServices();
            displayServices(services);
            updateMapMarkers(services);
            
            // Load statistics
            await loadStatistics();
            
            // Set up category filter buttons
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    
                    // Update active button styling
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                        btn.style.backgroundColor = '';
                        btn.style.color = '';
                    });
                    
                    this.classList.add('active');
                    this.style.backgroundColor = 'var(--primary-red)';
                    this.style.color = 'var(--white)';
                    
                    // Reset city filter
                    currentCity = null;
                    document.querySelectorAll('.city-chip').forEach(chip => {
                        chip.classList.remove('active');
                    });
                    
                    filterByCategory(category);
                });
            });
            
            // Set up search button
            document.getElementById('searchButton').addEventListener('click', function() {
                const query = document.getElementById('searchInput').value;
                searchServices(query);
            });
            
            // Allow pressing Enter to search
            document.getElementById('searchInput').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    searchServices(this.value);
                }
            });
            
            // Admin form submission
            document.getElementById('adminForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('adminUsername').value;
                const password = document.getElementById('adminPassword').value;
                
                // Simple demo authentication
                if (username === 'admin' && password === 'admin123') {
                    alert('Admin login successful! You can now add/edit/delete contacts.');
                    // In a real app, this would redirect to admin panel
                } else {
                    alert('Invalid credentials. Try admin/admin123 for demo.');
                }
                
                // Close modal
                const adminModal = bootstrap.Modal.getInstance(document.getElementById('adminModal'));
                adminModal.hide();
            });
            
            // Feedback form submission
            document.getElementById('feedbackForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('feedbackName').value;
                const contact = document.getElementById('feedbackContact').value;
                const message = document.getElementById('feedbackMessage').value;
                
                alert(`Thank you, ${name}! Your feedback has been submitted.\n\nWe will review your suggestion: "${message.substring(0, 50)}..."`);
                
                // Reset form
                this.reset();
                
                // Close modal
                const feedbackModal = bootstrap.Modal.getInstance(document.getElementById('feedbackModal'));
                feedbackModal.hide();
            });
            
            // SMS button functionality
            document.getElementById('smsBtn').addEventListener('click', function() {
                alert('SMS Alert feature: This would send an SMS with location and emergency details to selected contacts. (Demo feature)');
            });
            
            console.log('âœ… Application initialized successfully!');
        });
    </script>
</body>
</html>